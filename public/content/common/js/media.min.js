!function(t,o){t.noConflict();var a=a||t("#wrapper"),e=config.adminURL+"/media",n=t("[data-dropzone]"),i=n.attr("data-upload-url");t(document).on("click",".media-view",function(o){o.preventDefault();var e=t(this).attr("data-href");a.load(e+" #wrapper > *",function(){window.history.pushState({href:e},"",e),t("#media-modal").modal("show")})}),t(document).on("click",".media-delete",function(o){o.preventDefault();var a=t(".attachments > .attachment").length,n=t(this),i=i=n.attr("data-href"),d=n.attr("data-media-id"),r=r||t("#media-modal");bootbox.confirm({size:"small",message:mediaAlert.delete,callback:function(o){bootbox.hideAll(),!0===o&&i.length&&t.get(i,function(o,n){"success"==n?(a--,r.modal("hide"),toastr.success(o),a<=0?location.reload():t("#media-"+d).fadeOut(function(){t(this).remove()}),window.history.pushState({href:e},"",e)):toastr.error(o)})}})}),t(document).on("submit","form.media-update",function(o){o.preventDefault();var a=t(this),n=a.attr("action"),i=i||t("#media-modal"),d={name:t.trim(a.find("#name").val()),description:t.trim(a.find("#description").val())};t.post(n,d,function(t,o,a){toastr.success(t),i.modal("hide"),window.history.pushState({href:e},"",e)},"json").fail(function(t,o,a){toastr.error(t.responseJSON)})}),t(document).on("hide.bs.modal hidden.bs.modal","#media-modal",function(t){window.history.pushState({href:e},"",e)}),t(document).ready(function(){var o=o||t("#media-modal");o.length&&o.modal("show");new Dropzone("[data-dropzone]",{url:i,init:function(){this.on("sending",function(t,o,a){a.append("action","upload")})},success:function(t,o){n.load(window.location.href+" [data-dropzone] .attachments"),toastr.success(o)},error:function(t,o,a){toastr.error(o)}})})}(jQuery);
