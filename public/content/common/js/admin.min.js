(function(window, undefined) {
    "use strict";

    // Localize globals.
    var document = window.document,
        $ = window.$;

    $(document).ready(function() {

        // Some Toastr options.
        toastr.options = {
            "closeButton": true,
            "positionClass": "toast-top-center",
            "hideDuration": "300",
            "timeOut": "3000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        };

        if (config.lang.direction === 'rtl') {
            toastr.options.rtl = true;
        }

        /**
         * (A)Synchronous anchors.
         */
        $(document).on("click", "a[rel=async]", function (e) {
            /* Collect needed data first. */
            var $a = $(this),
                rel = $a.attr('rel'),
                url = $a.attr('ajaxify'),
                action = $a.attr('data-action'),
                confirm = $a.attr('data-confirm');

            /* Does it have a confirm message? */
            if (typeof confirm !== "undefined" && confirm !== false) {
                bootbox.confirm({
                    size: "small",
                    message: confirm,
                    callback: function(result) {
                        if (result === true) {
                            sendAjaxRequest('GET', url, {action: action});
                        }
                        bootbox.hideAll();
                    }
                });
            } else {
                sendAjaxRequest('GET', url, {action: action});
            }
            return;


            /* No valid URL? Nothing to do. */
            if (proceed === false || typeof url === "undefined") {
                e.preventDefault();
                return;
            }

            /* Send the AJAX GET request. */
            $.get(url, {next: config.currenURL}, function (response) {
                if (response.status == false) {
                    toastr.error(response.message);
                }
            }, 'json');
            // $.ajax({
            //     type: "GET",
            //     data: {next: config.currenURL},
            //     dataType: "json",
            //     url: url,
            //     success: function(response) {
            //         (response.action) && eval(response.action);
            //         (response.message) && toastr.success(response.message);
            //     },
            //     error: function(xhr, ajaxOptions, response) {
            //         toastr.error(response);
            //         // (response.message) && toastr.error(response.message);
            //     }
            //     // success: function (response) {
            //     //     /* Did the user provide an action to eval? */
            //     //     (response.action) && eval(response.action);
            //     //     setTimeout((function () {
            //     //         if (response.status == true) {
            //     //             toastr.success(response.message);
            //     //         } else {
            //     //             toastr.error(response.message);
            //     //         }
            //     //     }), 500);
            //     // }
            // });

            return false;
        });

        $(".alert-dismissable").fadeTo(2000, 500).slideUp(500, function() {
            $(this).alert("close");
        });

        $("[data-toggle=tooltip]").tooltip();

        // $("[data-confirm]").click(function(e) {
        //     var that = $(this);
        //     bootbox.confirm({
        //         size: "small",
        //         title: that.attr("title") || null,
        //         message: that.attr("data-confirm"),
        //         callback: function(result) {
        //             if (result == true) {
        //                 window.location.href = that.attr("data-href");
        //             } else {
        //                 bootbox.hideAll()
        //             }
        //         }
        //     });
        //     e.preventDefault();
        // });

    });

function sendAjaxRequest(_type, _url, _data = {}) {
    if (_url === "undefined") {
        return;
    }

    if (_type == 'GET' && _data.action) {
        _url = _url + "&action=" + _data.action;

        $.get(_url, function (response) {
            if (response.status === false) {
                toastr.error(response.message);
            } else {
                if (response.action) {
                    eval(response.action);
                }
                toastr.success(response.message);
            }
        }, 'json');
        return;
    }

    $.post(_url, _data, function (response) {
        if (response.status === false) {
            toastr.error(response.message);
        } else {
            if (response.action) {
                eval(response.action);
            }
            toastr.success(response.message);
        }
    }, 'json');
}

})(window);
